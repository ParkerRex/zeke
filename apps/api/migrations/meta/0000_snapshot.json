{
  "id": "00000000-0000-0000-0000-000000000000",
  "prevId": "",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.clusters": {
      "name": "clusters",
      "schema": "",
      "columns": {
        "cluster_key": {
          "name": "cluster_key",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "representative_story_id": {
          "name": "representative_story_id",
          "type": "uuid",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false,
          "default": "now()"
        }
      },
      "indexes": {
        "clusters_rep_story_idx": {
          "name": "clusters_rep_story_idx",
          "columns": [
            {
              "expression": "representative_story_id",
              "asc": true,
              "nulls": "last",
              "opclass": "uuid_ops",
              "isExpression": false
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "clusters_representative_story_id_fkey": {
          "name": "clusters_representative_story_id_fkey",
          "tableFrom": "clusters",
          "tableTo": "stories",
          "schemaTo": "public",
          "columnsFrom": [
            "representative_story_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "no action",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "checkConstraints": {},
      "policies": {
        "clusters_delete_consolidated": {
          "name": "clusters_delete_consolidated",
          "as": "PERMISSIVE",
          "for": "DELETE",
          "to": [
            "authenticated",
            "worker"
          ],
          "using": "(is_admin_user() OR is_worker_role())"
        },
        "clusters_insert_consolidated": {
          "name": "clusters_insert_consolidated",
          "as": "PERMISSIVE",
          "for": "INSERT",
          "to": [
            "authenticated",
            "worker"
          ]
        },
        "clusters_select_consolidated": {
          "name": "clusters_select_consolidated",
          "as": "PERMISSIVE",
          "for": "SELECT",
          "to": [
            "authenticated",
            "worker"
          ]
        },
        "clusters_update_consolidated": {
          "name": "clusters_update_consolidated",
          "as": "PERMISSIVE",
          "for": "UPDATE",
          "to": [
            "authenticated",
            "worker"
          ]
        }
      },
      "isRLSEnabled": true
    },
    "public.customers": {
      "name": "customers",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "uuid",
          "primaryKey": true,
          "notNull": true
        },
        "stripe_customer_id": {
          "name": "stripe_customer_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "customers_id_fkey": {
          "name": "customers_id_fkey",
          "tableFrom": "customers",
          "tableTo": "users",
          "schemaTo": "auth",
          "columnsFrom": [
            "id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "no action",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "checkConstraints": {},
      "policies": {},
      "isRLSEnabled": true
    },
    "public.highlights": {
      "name": "highlights",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "uuid",
          "primaryKey": true,
          "notNull": true,
          "default": "gen_random_uuid()"
        },
        "user_id": {
          "name": "user_id",
          "type": "uuid",
          "primaryKey": false,
          "notNull": true
        },
        "story_id": {
          "name": "story_id",
          "type": "uuid",
          "primaryKey": false,
          "notNull": true
        },
        "content_id": {
          "name": "content_id",
          "type": "uuid",
          "primaryKey": false,
          "notNull": true
        },
        "span": {
          "name": "span",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false,
          "default": "now()"
        }
      },
      "indexes": {
        "highlights_story_idx": {
          "name": "highlights_story_idx",
          "columns": [
            {
              "expression": "story_id",
              "asc": true,
              "nulls": "last",
              "opclass": "uuid_ops",
              "isExpression": false
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "highlights_user_idx": {
          "name": "highlights_user_idx",
          "columns": [
            {
              "expression": "user_id",
              "asc": true,
              "nulls": "last",
              "opclass": "uuid_ops",
              "isExpression": false
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "highlights_content_id_fkey": {
          "name": "highlights_content_id_fkey",
          "tableFrom": "highlights",
          "tableTo": "contents",
          "schemaTo": "public",
          "columnsFrom": [
            "content_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "highlights_story_id_fkey": {
          "name": "highlights_story_id_fkey",
          "tableFrom": "highlights",
          "tableTo": "stories",
          "schemaTo": "public",
          "columnsFrom": [
            "story_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "checkConstraints": {},
      "policies": {
        "highlights_delete_own": {
          "name": "highlights_delete_own",
          "as": "PERMISSIVE",
          "for": "DELETE",
          "to": [
            "authenticated"
          ],
          "using": "(( SELECT auth.uid() AS uid) = user_id)"
        },
        "highlights_insert_own": {
          "name": "highlights_insert_own",
          "as": "PERMISSIVE",
          "for": "INSERT",
          "to": [
            "authenticated"
          ]
        },
        "highlights_select_own": {
          "name": "highlights_select_own",
          "as": "PERMISSIVE",
          "for": "SELECT",
          "to": [
            "authenticated"
          ]
        },
        "highlights_update_own": {
          "name": "highlights_update_own",
          "as": "PERMISSIVE",
          "for": "UPDATE",
          "to": [
            "authenticated"
          ]
        }
      },
      "isRLSEnabled": true
    },
    "public.platform_quota": {
      "name": "platform_quota",
      "schema": "",
      "columns": {
        "provider": {
          "name": "provider",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "quota_limit": {
          "name": "quota_limit",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "used": {
          "name": "used",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "remaining": {
          "name": "remaining",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "reset_at": {
          "name": "reset_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "checkConstraints": {},
      "policies": {
        "platform_quota_admin_select": {
          "name": "platform_quota_admin_select",
          "as": "PERMISSIVE",
          "for": "SELECT",
          "to": [
            "authenticated"
          ],
          "using": "is_admin_user()"
        },
        "platform_quota_worker_all": {
          "name": "platform_quota_worker_all",
          "as": "PERMISSIVE",
          "for": "ALL",
          "to": [
            "worker"
          ]
        }
      },
      "isRLSEnabled": true
    },
    "public.prices": {
      "name": "prices",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "product_id": {
          "name": "product_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "active": {
          "name": "active",
          "type": "boolean",
          "primaryKey": false,
          "notNull": false
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "unit_amount": {
          "name": "unit_amount",
          "type": "bigint",
          "primaryKey": false,
          "notNull": false
        },
        "currency": {
          "name": "currency",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "type": {
          "name": "type",
          "type": "pricing_type",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": false
        },
        "interval": {
          "name": "interval",
          "type": "pricing_plan_interval",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": false
        },
        "interval_count": {
          "name": "interval_count",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "trial_period_days": {
          "name": "trial_period_days",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "metadata": {
          "name": "metadata",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "prices_product_id_fkey": {
          "name": "prices_product_id_fkey",
          "tableFrom": "prices",
          "tableTo": "products",
          "schemaTo": "public",
          "columnsFrom": [
            "product_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "no action",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "checkConstraints": {
        "prices_currency_check": {
          "name": "prices_currency_check",
          "value": "char_length(currency) = 3"
        }
      },
      "policies": {
        "Allow public read-only access.": {
          "name": "Allow public read-only access.",
          "as": "PERMISSIVE",
          "for": "SELECT",
          "to": [
            "public"
          ],
          "using": "true"
        }
      },
      "isRLSEnabled": true
    },
    "public.products": {
      "name": "products",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "active": {
          "name": "active",
          "type": "boolean",
          "primaryKey": false,
          "notNull": false
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "image": {
          "name": "image",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "metadata": {
          "name": "metadata",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "checkConstraints": {},
      "policies": {
        "Allow public read-only access.": {
          "name": "Allow public read-only access.",
          "as": "PERMISSIVE",
          "for": "SELECT",
          "to": [
            "public"
          ],
          "using": "true"
        }
      },
      "isRLSEnabled": true
    },
    "public.raw_items": {
      "name": "raw_items",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "uuid",
          "primaryKey": true,
          "notNull": true,
          "default": "gen_random_uuid()"
        },
        "source_id": {
          "name": "source_id",
          "type": "uuid",
          "primaryKey": false,
          "notNull": true
        },
        "external_id": {
          "name": "external_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "url": {
          "name": "url",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "kind": {
          "name": "kind",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "title": {
          "name": "title",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "metadata": {
          "name": "metadata",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        },
        "discovered_at": {
          "name": "discovered_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false,
          "default": "now()"
        },
        "status": {
          "name": "status",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "error": {
          "name": "error",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "attempts": {
          "name": "attempts",
          "type": "integer",
          "primaryKey": false,
          "notNull": false,
          "default": 0
        }
      },
      "indexes": {
        "idx_raw_items_youtube": {
          "name": "idx_raw_items_youtube",
          "columns": [
            {
              "expression": "kind",
              "asc": true,
              "nulls": "last",
              "opclass": "text_ops",
              "isExpression": false
            },
            {
              "expression": "external_id",
              "asc": true,
              "nulls": "last",
              "opclass": "text_ops",
              "isExpression": false
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "where": "(kind = 'youtube'::text)",
          "with": {}
        },
        "raw_items_source_discovered_idx": {
          "name": "raw_items_source_discovered_idx",
          "columns": [
            {
              "expression": "source_id",
              "asc": true,
              "nulls": "last",
              "opclass": "timestamptz_ops",
              "isExpression": false
            },
            {
              "expression": "discovered_at",
              "asc": false,
              "nulls": "first",
              "opclass": "timestamptz_ops",
              "isExpression": false
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "raw_items_source_external_unique": {
          "name": "raw_items_source_external_unique",
          "columns": [
            {
              "expression": "source_id",
              "asc": true,
              "nulls": "last",
              "opclass": "text_ops",
              "isExpression": false
            },
            {
              "expression": "external_id",
              "asc": true,
              "nulls": "last",
              "opclass": "text_ops",
              "isExpression": false
            }
          ],
          "isUnique": true,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "raw_items_source_id_fkey": {
          "name": "raw_items_source_id_fkey",
          "tableFrom": "raw_items",
          "tableTo": "sources",
          "schemaTo": "public",
          "columnsFrom": [
            "source_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "checkConstraints": {},
      "policies": {
        "raw_items_admin_all": {
          "name": "raw_items_admin_all",
          "as": "PERMISSIVE",
          "for": "ALL",
          "to": [
            "authenticated"
          ],
          "withCheck": "is_admin_user()",
          "using": "is_admin_user()"
        },
        "raw_items_worker_all": {
          "name": "raw_items_worker_all",
          "as": "PERMISSIVE",
          "for": "ALL",
          "to": [
            "worker"
          ]
        }
      },
      "isRLSEnabled": true
    },
    "public.contents": {
      "name": "contents",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "uuid",
          "primaryKey": true,
          "notNull": true,
          "default": "gen_random_uuid()"
        },
        "raw_item_id": {
          "name": "raw_item_id",
          "type": "uuid",
          "primaryKey": false,
          "notNull": true
        },
        "text": {
          "name": "text",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "html_url": {
          "name": "html_url",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "transcript_url": {
          "name": "transcript_url",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "pdf_url": {
          "name": "pdf_url",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "lang": {
          "name": "lang",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "extracted_at": {
          "name": "extracted_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false,
          "default": "now()"
        },
        "content_hash": {
          "name": "content_hash",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "audio_url": {
          "name": "audio_url",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "duration_seconds": {
          "name": "duration_seconds",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "view_count": {
          "name": "view_count",
          "type": "bigint",
          "primaryKey": false,
          "notNull": false
        },
        "transcript_vtt": {
          "name": "transcript_vtt",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {
        "contents_content_hash_idx": {
          "name": "contents_content_hash_idx",
          "columns": [
            {
              "expression": "content_hash",
              "asc": true,
              "nulls": "last",
              "opclass": "text_ops",
              "isExpression": false
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "idx_contents_audio_url": {
          "name": "idx_contents_audio_url",
          "columns": [
            {
              "expression": "audio_url",
              "asc": true,
              "nulls": "last",
              "opclass": "text_ops",
              "isExpression": false
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "where": "(audio_url IS NOT NULL)",
          "with": {}
        },
        "idx_contents_transcript_url": {
          "name": "idx_contents_transcript_url",
          "columns": [
            {
              "expression": "transcript_url",
              "asc": true,
              "nulls": "last",
              "opclass": "text_ops",
              "isExpression": false
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "where": "(transcript_url IS NOT NULL)",
          "with": {}
        },
        "idx_contents_transcript_vtt": {
          "name": "idx_contents_transcript_vtt",
          "columns": [
            {
              "expression": "id",
              "asc": true,
              "nulls": "last",
              "opclass": "uuid_ops",
              "isExpression": false
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "where": "(transcript_vtt IS NOT NULL)",
          "with": {}
        }
      },
      "foreignKeys": {
        "contents_raw_item_id_fkey": {
          "name": "contents_raw_item_id_fkey",
          "tableFrom": "contents",
          "tableTo": "raw_items",
          "schemaTo": "public",
          "columnsFrom": [
            "raw_item_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "checkConstraints": {},
      "policies": {
        "contents_select_consolidated": {
          "name": "contents_select_consolidated",
          "as": "PERMISSIVE",
          "for": "SELECT",
          "to": [
            "authenticated",
            "worker"
          ],
          "using": "(is_admin_user() OR is_worker_role() OR true)"
        },
        "contents_worker_all": {
          "name": "contents_worker_all",
          "as": "PERMISSIVE",
          "for": "ALL",
          "to": [
            "worker"
          ]
        },
        "contents_authenticated_read": {
          "name": "contents_authenticated_read",
          "as": "PERMISSIVE",
          "for": "SELECT",
          "to": [
            "authenticated"
          ]
        },
        "contents_admin_all": {
          "name": "contents_admin_all",
          "as": "PERMISSIVE",
          "for": "ALL",
          "to": [
            "authenticated"
          ]
        }
      },
      "isRLSEnabled": true
    },
    "public.source_health": {
      "name": "source_health",
      "schema": "",
      "columns": {
        "source_id": {
          "name": "source_id",
          "type": "uuid",
          "primaryKey": true,
          "notNull": true
        },
        "status": {
          "name": "status",
          "type": "health_status",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": true,
          "default": "'ok'"
        },
        "last_success_at": {
          "name": "last_success_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false
        },
        "last_error_at": {
          "name": "last_error_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false
        },
        "error_24h": {
          "name": "error_24h",
          "type": "integer",
          "primaryKey": false,
          "notNull": false,
          "default": 0
        },
        "message": {
          "name": "message",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "source_health_source_id_fkey": {
          "name": "source_health_source_id_fkey",
          "tableFrom": "source_health",
          "tableTo": "sources",
          "schemaTo": "public",
          "columnsFrom": [
            "source_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "checkConstraints": {},
      "policies": {
        "source_health_admin_select": {
          "name": "source_health_admin_select",
          "as": "PERMISSIVE",
          "for": "SELECT",
          "to": [
            "authenticated"
          ],
          "using": "is_admin_user()"
        },
        "source_health_worker_all": {
          "name": "source_health_worker_all",
          "as": "PERMISSIVE",
          "for": "ALL",
          "to": [
            "worker"
          ]
        }
      },
      "isRLSEnabled": true
    },
    "public.source_metrics": {
      "name": "source_metrics",
      "schema": "",
      "columns": {
        "source_id": {
          "name": "source_id",
          "type": "uuid",
          "primaryKey": true,
          "notNull": true
        },
        "raw_total": {
          "name": "raw_total",
          "type": "integer",
          "primaryKey": false,
          "notNull": false,
          "default": 0
        },
        "contents_total": {
          "name": "contents_total",
          "type": "integer",
          "primaryKey": false,
          "notNull": false,
          "default": 0
        },
        "stories_total": {
          "name": "stories_total",
          "type": "integer",
          "primaryKey": false,
          "notNull": false,
          "default": 0
        },
        "raw_24h": {
          "name": "raw_24h",
          "type": "integer",
          "primaryKey": false,
          "notNull": false,
          "default": 0
        },
        "contents_24h": {
          "name": "contents_24h",
          "type": "integer",
          "primaryKey": false,
          "notNull": false,
          "default": 0
        },
        "stories_24h": {
          "name": "stories_24h",
          "type": "integer",
          "primaryKey": false,
          "notNull": false,
          "default": 0
        },
        "last_raw_at": {
          "name": "last_raw_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false
        },
        "last_content_at": {
          "name": "last_content_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false
        },
        "last_story_at": {
          "name": "last_story_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "source_metrics_source_id_fkey": {
          "name": "source_metrics_source_id_fkey",
          "tableFrom": "source_metrics",
          "tableTo": "sources",
          "schemaTo": "public",
          "columnsFrom": [
            "source_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "checkConstraints": {},
      "policies": {
        "source_metrics_admin_select": {
          "name": "source_metrics_admin_select",
          "as": "PERMISSIVE",
          "for": "SELECT",
          "to": [
            "authenticated"
          ],
          "using": "is_admin_user()"
        },
        "source_metrics_worker_insert": {
          "name": "source_metrics_worker_insert",
          "as": "PERMISSIVE",
          "for": "INSERT",
          "to": [
            "worker"
          ]
        },
        "source_metrics_worker_update": {
          "name": "source_metrics_worker_update",
          "as": "PERMISSIVE",
          "for": "UPDATE",
          "to": [
            "worker"
          ]
        },
        "source_metrics_worker_select": {
          "name": "source_metrics_worker_select",
          "as": "PERMISSIVE",
          "for": "SELECT",
          "to": [
            "worker"
          ]
        }
      },
      "isRLSEnabled": true
    },
    "public.sources": {
      "name": "sources",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "uuid",
          "primaryKey": true,
          "notNull": true,
          "default": "gen_random_uuid()"
        },
        "kind": {
          "name": "kind",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "url": {
          "name": "url",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "domain": {
          "name": "domain",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "authority_score": {
          "name": "authority_score",
          "type": "numeric",
          "primaryKey": false,
          "notNull": false
        },
        "last_cursor": {
          "name": "last_cursor",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        },
        "last_checked": {
          "name": "last_checked",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false
        },
        "metadata": {
          "name": "metadata",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        },
        "active": {
          "name": "active",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "sources_domain_idx": {
          "name": "sources_domain_idx",
          "columns": [
            {
              "expression": "domain",
              "asc": true,
              "nulls": "last",
              "opclass": "text_ops",
              "isExpression": false
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "checkConstraints": {
        "check_youtube_metadata": {
          "name": "check_youtube_metadata",
          "value": "(kind <> ALL (ARRAY['youtube_channel'::text, 'youtube_search'::text])) OR ((metadata IS NOT NULL) AND (metadata <> '{}'::jsonb))"
        }
      },
      "policies": {
        "sources_delete_consolidated": {
          "name": "sources_delete_consolidated",
          "as": "PERMISSIVE",
          "for": "DELETE",
          "to": [
            "authenticated",
            "worker"
          ],
          "using": "(is_admin_user() OR is_worker_role())"
        },
        "sources_insert_consolidated": {
          "name": "sources_insert_consolidated",
          "as": "PERMISSIVE",
          "for": "INSERT",
          "to": [
            "authenticated",
            "worker"
          ]
        },
        "sources_select_consolidated": {
          "name": "sources_select_consolidated",
          "as": "PERMISSIVE",
          "for": "SELECT",
          "to": [
            "authenticated",
            "worker"
          ]
        },
        "sources_update_consolidated": {
          "name": "sources_update_consolidated",
          "as": "PERMISSIVE",
          "for": "UPDATE",
          "to": [
            "authenticated",
            "worker"
          ]
        }
      },
      "isRLSEnabled": true
    },
    "public.stories": {
      "name": "stories",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "uuid",
          "primaryKey": true,
          "notNull": true,
          "default": "gen_random_uuid()"
        },
        "content_id": {
          "name": "content_id",
          "type": "uuid",
          "primaryKey": false,
          "notNull": true
        },
        "canonical_url": {
          "name": "canonical_url",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "kind": {
          "name": "kind",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "title": {
          "name": "title",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "primary_url": {
          "name": "primary_url",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "published_at": {
          "name": "published_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false
        },
        "cluster_key": {
          "name": "cluster_key",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false,
          "default": "now()"
        }
      },
      "indexes": {
        "stories_cluster_key_idx": {
          "name": "stories_cluster_key_idx",
          "columns": [
            {
              "expression": "cluster_key",
              "asc": true,
              "nulls": "last",
              "opclass": "text_ops",
              "isExpression": false
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "stories_created_idx": {
          "name": "stories_created_idx",
          "columns": [
            {
              "expression": "created_at",
              "asc": false,
              "nulls": "first",
              "opclass": "timestamptz_ops",
              "isExpression": false
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "stories_published_idx": {
          "name": "stories_published_idx",
          "columns": [
            {
              "expression": "published_at",
              "asc": true,
              "nulls": "last",
              "opclass": "timestamptz_ops",
              "isExpression": false
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "stories_content_id_fkey": {
          "name": "stories_content_id_fkey",
          "tableFrom": "stories",
          "tableTo": "contents",
          "schemaTo": "public",
          "columnsFrom": [
            "content_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "restrict",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "stories_content_id_key": {
          "columns": [
            "content_id"
          ],
          "nullsNotDistinct": false,
          "name": "stories_content_id_key"
        }
      },
      "checkConstraints": {},
      "policies": {
        "stories_delete_consolidated": {
          "name": "stories_delete_consolidated",
          "as": "PERMISSIVE",
          "for": "DELETE",
          "to": [
            "authenticated",
            "worker"
          ],
          "using": "(is_admin_user() OR is_worker_role())"
        },
        "stories_insert_consolidated": {
          "name": "stories_insert_consolidated",
          "as": "PERMISSIVE",
          "for": "INSERT",
          "to": [
            "authenticated",
            "worker"
          ]
        },
        "stories_select_consolidated": {
          "name": "stories_select_consolidated",
          "as": "PERMISSIVE",
          "for": "SELECT",
          "to": [
            "authenticated",
            "worker"
          ]
        },
        "stories_update_consolidated": {
          "name": "stories_update_consolidated",
          "as": "PERMISSIVE",
          "for": "UPDATE",
          "to": [
            "authenticated",
            "worker"
          ]
        }
      },
      "isRLSEnabled": true
    },
    "public.story_embeddings": {
      "name": "story_embeddings",
      "schema": "",
      "columns": {
        "story_id": {
          "name": "story_id",
          "type": "uuid",
          "primaryKey": true,
          "notNull": true
        },
        "model_version": {
          "name": "model_version",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "embedding": {
          "name": "embedding",
          "type": "vector(1536)",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {
        "story_embeddings_l2_idx": {
          "name": "story_embeddings_l2_idx",
          "columns": [
            {
              "expression": "embedding",
              "asc": true,
              "nulls": "last",
              "opclass": "vector_l2_ops",
              "isExpression": false
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "ivfflat",
          "with": {
            "lists": "100"
          }
        }
      },
      "foreignKeys": {
        "story_embeddings_story_id_fkey": {
          "name": "story_embeddings_story_id_fkey",
          "tableFrom": "story_embeddings",
          "tableTo": "stories",
          "schemaTo": "public",
          "columnsFrom": [
            "story_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "checkConstraints": {},
      "policies": {
        "story_embeddings_delete_consolidated": {
          "name": "story_embeddings_delete_consolidated",
          "as": "PERMISSIVE",
          "for": "DELETE",
          "to": [
            "authenticated",
            "worker"
          ],
          "using": "(is_admin_user() OR is_worker_role())"
        },
        "story_embeddings_insert_consolidated": {
          "name": "story_embeddings_insert_consolidated",
          "as": "PERMISSIVE",
          "for": "INSERT",
          "to": [
            "authenticated",
            "worker"
          ]
        },
        "story_embeddings_select_consolidated": {
          "name": "story_embeddings_select_consolidated",
          "as": "PERMISSIVE",
          "for": "SELECT",
          "to": [
            "authenticated",
            "worker"
          ]
        },
        "story_embeddings_update_consolidated": {
          "name": "story_embeddings_update_consolidated",
          "as": "PERMISSIVE",
          "for": "UPDATE",
          "to": [
            "authenticated",
            "worker"
          ]
        }
      },
      "isRLSEnabled": true
    },
    "public.story_overlays": {
      "name": "story_overlays",
      "schema": "",
      "columns": {
        "story_id": {
          "name": "story_id",
          "type": "uuid",
          "primaryKey": true,
          "notNull": true
        },
        "why_it_matters": {
          "name": "why_it_matters",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "chili": {
          "name": "chili",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "confidence": {
          "name": "confidence",
          "type": "numeric",
          "primaryKey": false,
          "notNull": false
        },
        "citations": {
          "name": "citations",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        },
        "model_version": {
          "name": "model_version",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "analyzed_at": {
          "name": "analyzed_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "story_overlays_story_id_fkey": {
          "name": "story_overlays_story_id_fkey",
          "tableFrom": "story_overlays",
          "tableTo": "stories",
          "schemaTo": "public",
          "columnsFrom": [
            "story_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "checkConstraints": {},
      "policies": {
        "story_overlays_delete_consolidated": {
          "name": "story_overlays_delete_consolidated",
          "as": "PERMISSIVE",
          "for": "DELETE",
          "to": [
            "authenticated",
            "worker"
          ],
          "using": "(is_admin_user() OR is_worker_role())"
        },
        "story_overlays_insert_consolidated": {
          "name": "story_overlays_insert_consolidated",
          "as": "PERMISSIVE",
          "for": "INSERT",
          "to": [
            "authenticated",
            "worker"
          ]
        },
        "story_overlays_select_consolidated": {
          "name": "story_overlays_select_consolidated",
          "as": "PERMISSIVE",
          "for": "SELECT",
          "to": [
            "authenticated",
            "worker"
          ]
        },
        "story_overlays_update_consolidated": {
          "name": "story_overlays_update_consolidated",
          "as": "PERMISSIVE",
          "for": "UPDATE",
          "to": [
            "authenticated",
            "worker"
          ]
        }
      },
      "isRLSEnabled": true
    },
    "public.subscriptions": {
      "name": "subscriptions",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "uuid",
          "primaryKey": false,
          "notNull": true
        },
        "status": {
          "name": "status",
          "type": "subscription_status",
          "typeSchema": "public",
          "primaryKey": false,
          "notNull": false
        },
        "metadata": {
          "name": "metadata",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        },
        "price_id": {
          "name": "price_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "quantity": {
          "name": "quantity",
          "type": "integer",
          "primaryKey": false,
          "notNull": false
        },
        "cancel_at_period_end": {
          "name": "cancel_at_period_end",
          "type": "boolean",
          "primaryKey": false,
          "notNull": false
        },
        "created": {
          "name": "created",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "timezone('utc'::text, now())"
        },
        "current_period_start": {
          "name": "current_period_start",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "timezone('utc'::text, now())"
        },
        "current_period_end": {
          "name": "current_period_end",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "timezone('utc'::text, now())"
        },
        "ended_at": {
          "name": "ended_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false,
          "default": "timezone('utc'::text, now())"
        },
        "cancel_at": {
          "name": "cancel_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false,
          "default": "timezone('utc'::text, now())"
        },
        "canceled_at": {
          "name": "canceled_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false,
          "default": "timezone('utc'::text, now())"
        },
        "trial_start": {
          "name": "trial_start",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false,
          "default": "timezone('utc'::text, now())"
        },
        "trial_end": {
          "name": "trial_end",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false,
          "default": "timezone('utc'::text, now())"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "subscriptions_price_id_fkey": {
          "name": "subscriptions_price_id_fkey",
          "tableFrom": "subscriptions",
          "tableTo": "prices",
          "schemaTo": "public",
          "columnsFrom": [
            "price_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "no action",
          "onUpdate": "no action"
        },
        "subscriptions_user_id_fkey": {
          "name": "subscriptions_user_id_fkey",
          "tableFrom": "subscriptions",
          "tableTo": "users",
          "schemaTo": "auth",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "no action",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "checkConstraints": {},
      "policies": {
        "subscriptions_select_own": {
          "name": "subscriptions_select_own",
          "as": "PERMISSIVE",
          "for": "SELECT",
          "to": [
            "authenticated"
          ],
          "using": "(( SELECT auth.uid() AS uid) = user_id)"
        }
      },
      "isRLSEnabled": true
    },
    "public.users": {
      "name": "users",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "uuid",
          "primaryKey": true,
          "notNull": true
        },
        "full_name": {
          "name": "full_name",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "avatar_url": {
          "name": "avatar_url",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "billing_address": {
          "name": "billing_address",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        },
        "payment_method": {
          "name": "payment_method",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false
        },
        "is_admin": {
          "name": "is_admin",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        }
      },
      "indexes": {},
      "foreignKeys": {
        "users_id_fkey": {
          "name": "users_id_fkey",
          "tableFrom": "users",
          "tableTo": "users",
          "schemaTo": "auth",
          "columnsFrom": [
            "id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "no action",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "checkConstraints": {},
      "policies": {
        "users_select_own": {
          "name": "users_select_own",
          "as": "PERMISSIVE",
          "for": "SELECT",
          "to": [
            "authenticated"
          ],
          "using": "(( SELECT auth.uid() AS uid) = id)"
        },
        "users_update_own": {
          "name": "users_update_own",
          "as": "PERMISSIVE",
          "for": "UPDATE",
          "to": [
            "authenticated"
          ]
        }
      },
      "isRLSEnabled": true
    },
    "public.job_metrics": {
      "name": "job_metrics",
      "schema": "",
      "columns": {
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "state": {
          "name": "state",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "count": {
          "name": "count",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 0
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {
        "job_metrics_pkey": {
          "name": "job_metrics_pkey",
          "columns": [
            "name",
            "state"
          ]
        }
      },
      "uniqueConstraints": {},
      "checkConstraints": {},
      "policies": {
        "job_metrics_admin_select": {
          "name": "job_metrics_admin_select",
          "as": "PERMISSIVE",
          "for": "SELECT",
          "to": [
            "authenticated"
          ],
          "using": "is_admin_user()"
        },
        "job_metrics_worker_all": {
          "name": "job_metrics_worker_all",
          "as": "PERMISSIVE",
          "for": "ALL",
          "to": [
            "worker"
          ]
        }
      },
      "isRLSEnabled": true
    }
  },
  "enums": {
    "public.health_status": {
      "name": "health_status",
      "values": [
        "ok",
        "warn",
        "error"
      ],
      "schema": "public"
    },
    "public.pricing_plan_interval": {
      "name": "pricing_plan_interval",
      "values": [
        "day",
        "week",
        "month",
        "year"
      ],
      "schema": "public"
    },
    "public.pricing_type": {
      "name": "pricing_type",
      "values": [
        "one_time",
        "recurring"
      ],
      "schema": "public"
    },
    "public.subscription_status": {
      "name": "subscription_status",
      "values": [
        "trialing",
        "active",
        "canceled",
        "incomplete",
        "incomplete_expired",
        "past_due",
        "unpaid",
        "paused"
      ],
      "schema": "public"
    }
  },
  "schemas": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "views": {},
  "_meta": {
    "schemas": {},
    "tables": {},
    "columns": {}
  },
  "internal": {
    "tables": {}
  }
}