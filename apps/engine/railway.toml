[build]
builder = "dockerfile"
dockerfilePath = "Dockerfile"

[deploy]
healthcheckPath = "/healthz"
healthcheckTimeout = 60
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3

[env]
# These will need to be set in Railway dashboard
# Using existing Supabase Cloud database (no Railway PostgreSQL needed)
# DATABASE_URL = "postgresql://worker:${{WORKER_DB_PASSWORD}}@aws-0-us-east-1.pooler.supabase.com:5432/postgres"
# NEXT_PUBLIC_SUPABASE_URL = "https://hblelrtwdpukaymtpchv.supabase.co"
# NEXT_PUBLIC_SUPABASE_ANON_KEY = "${{SUPABASE_ANON_KEY}}"
# SUPABASE_SERVICE_ROLE_KEY = "${{SUPABASE_SERVICE_ROLE_KEY}}"
# OPENAI_API_KEY = "${{OPENAI_API_KEY}}"
# YOUTUBE_API_KEY = "${{YOUTUBE_API_KEY}}"
# NODE_ENV = "production"
# PORT = "8080"

[variables]
# Default port for Railway
PORT = "8080"
NODE_ENV = "production"
BOSS_SCHEMA = "pgboss"
BOSS_MIGRATE = "false"  # Schema already exists in Supabase
USE_SSL = "true"

# YouTube processing is optional - will be skipped if YOUTUBE_API_KEY is not set
YOUTUBE_PROCESSING_ENABLED = "false"

# Railway-specific optimizations
[build.env]
NODE_ENV = "production"
PNPM_FLAGS = "--prod --frozen-lockfile"

# Resource limits (adjust based on needs)
[resources]
memory = "512Mi"
cpu = "0.5"

# Networking
[networking]
port = 8080
protocol = "http"

# Logging configuration
[logging]
level = "info"
format = "json"

# Auto-scaling (Railway Pro feature)
[scaling]
min_replicas = 1
max_replicas = 3
target_cpu = 70
target_memory = 80
